<div id="server-rack-vizualization">
    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
        <h3 class="text-xl font-semibold mb-2">Rack Visualization</h3>
        
        <div class="border border-gray-300 dark:border-gray-700 rounded-md p-2 bg-gray-100 dark:bg-gray-900 overflow-hidden">
            <div id="server-front" class="relative" style="height: <%= @server_rack.height * 40 + 20 %>px;">
                <% if @rack_components.any? %>
                    <% @rack_components.each do |rack_component| %>
                        <% 
                            # Generate color based on component name for visual distinction
                            component_name = rack_component.component.name.downcase
                            bg_color = if component_name.include?('server')
                                "bg-blue-100 dark:bg-blue-900 border-blue-500"
                            elsif component_name.include?('network') || component_name.include?('switch') || component_name.include?('router')
                                "bg-green-100 dark:bg-green-900 border-green-500"
                            elsif component_name.include?('ups') || component_name.include?('power')
                                "bg-red-100 dark:bg-red-900 border-red-500"
                            elsif component_name.include?('storage') || component_name.include?('disk') || component_name.include?('nas')
                                "bg-yellow-100 dark:bg-yellow-900 border-yellow-500"
                            else
                                "bg-purple-100 dark:bg-purple-900 border-purple-500"
                            end
                        %>
                        <div class="component absolute rounded-md p-1 border <%= bg_color %> text-center overflow-hidden flex items-center justify-center"
                             style="top: <%= (rack_component.position_y - 1) * 40 %>px; 
                                    height: <%= rack_component.component.height * 40 %>px;
                                    left: 30px; 
                                    right: 0;">
                            <% if rack_component.component.height == 1 %>
                              <!-- For 1U components, display everything on a single line -->
                              <div class="text-sm">
                                <span class="font-bold"><%= rack_component.component.name %></span>
                                <span class="text-xs ml-1">(<%= rack_component.component.height %>U • <%= rack_component.component.depth %>")</span>
                              </div>
                            <% else %>
                              <!-- For taller components, maintain the stacked layout -->
                              <div>
                                <div class="font-bold"><%= rack_component.component.name %></div>
                                <div class="text-xs">
                                  <%= rack_component.component.height %>U • <%= rack_component.component.depth %>"
                                </div>
                              </div>
                            <% end %>
                        </div>
                    <% end %>
                <% else %>
                    <div class="absolute text-center text-gray-500 p-4" style="left: 30px; right: 0; top: 40px;">
                        No components added to this rack yet.
                    </div>
                <% end %>
                
                <!-- Rack unit markers -->
                <% @server_rack.height.times do |i| %>
                    <div class="absolute left-0 bg-gray-200 dark:bg-gray-700 px-1 text-xs text-gray-700 dark:text-gray-300 border-r border-gray-300 dark:border-gray-600 flex items-center justify-center" 
                         style="top: <%= i * 40 %>px; height: 40px; width: 30px;">
                        <%= i + 1 %>U
                    </div>
                <% end %>
                
                <!-- Rack background grid lines -->
                <% @server_rack.height.times do |i| %>
                    <div class="absolute left-0 right-0 border-t border-gray-300 dark:border-gray-700" 
                         style="top: <%= i * 40 %>px; height: 1px; left: 30px;"></div>
                <% end %>
            </div>
        </div>
    </div>
</div>

<%= javascript_include_tag 'packs/server_racks' %>